<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Diseñador Virtual - JBC Textil{% endblock %}</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preload" as="style"
        href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet"
        media="all" onload="this.media='all'">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/index.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/cart.css') }}">
    <link rel="icon" href="{{ url_for('static', filename='img/logo/logo_jbctextil.webp') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        body {
            background-color: #f8f9fa;

        }

        .bg-primario {
            background-color: #fff500;
            color: black;

        }
        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        .page-title {
            text-align: center;
            margin-bottom: 30px;
            color: #333;
            font-weight: 600;
        }
        .section-card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 15px;
            overflow: hidden;
        }
        .section-header {
            background-color: #0d6efd;
            color: white;
            padding: 10px 15px;
            font-weight: 500;
            font-size: 16px;
            margin: 0;
        }
        .section-body {
            padding: 12px;
        }
        .color-option {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            margin: 0 5px 5px 0;
            cursor: pointer;
            border: 2px solid #ddd;
            position: relative;
            transition: all 0.3s ease-in-out;
        }
        #color-availability-message {
            min-height: 20px;
            font-style: italic;
            color: #6c757d;
            margin-bottom: 10px;
            transition: opacity 0.3s ease-in-out;
        }
        
        /* Estilos para posicionar el modal de confirmación encima del modal de selección */
        #confirmChangeModal {
            z-index: 1060 !important; /* Mayor que el z-index por defecto de Bootstrap (1050) */
        }
        
        /* Asegurar que el backdrop del modal de confirmación esté encima del modal de selección */
        .modal-backdrop.show:nth-of-type(2) {
            z-index: 1055 !important;
        }
        .color-option:hover {
            transform: scale(1.1);
        }
        .color-option.active {
            border: 3px solid #000;
        }
        .shirt-preview-container {
            position: relative;
            width: 100%;
            max-width: 550px;
            margin: 0 auto;
        }
        .shirt-preview {
            max-width: 100%;
            height: auto;
            margin: 0 auto;
            display: block;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
        }
        #shirt-image-base {
            z-index: 1;
            position: relative;
        }
        .shirt-color-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2;
            mix-blend-mode: multiply;
            opacity: 0.8;
            display: none;
            -webkit-mask-size: contain;
            -webkit-mask-repeat: no-repeat;
            -webkit-mask-position: center;
            mask-size: contain;
            mask-repeat: no-repeat;
            mask-position: center;
        }
        
        .custom-color-option {
            position: relative;
        }
        
        .delete-color-btn {
            position: absolute;
            top: -8px;
            right: -8px;
            background-color: #dc3545;
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.2s ease;
            z-index: 10;
        }
        
        .custom-color-option:hover .delete-color-btn {
            opacity: 1;
        }
        #shirt-image-overlay {
            z-index: 3;
        }
        .view-option {
            cursor: pointer;
            padding: 8px 12px;
            margin: 4px;
            border: 1px solid #ddd;
            width: calc(50% - 8px);
            text-align: center;
            display: inline-block;
            border-radius: 5px;
            font-weight: 500;
            font-size: 14px;
        }
        .view-option.active {
            background-color: #28a745;
            color: white;
            border-color: #28a745;
        }
        .logo-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
        }
        .logo-item {
            position: absolute;
            cursor: move;
            z-index: 100;
            border: 2px dashed transparent;
            user-select: none;
        }
        
        .text-item {
            padding: 5px;
            border-radius: 3px;
            transition: all 0.2s ease;
        }
        
        .text-item:hover {
            background-color: rgba(0, 123, 255, 0.1);
            box-shadow: 0 0 5px rgba(0, 123, 255, 0.3);
        }
        
        .text-item.editing {
            background-color: rgba(0, 123, 255, 0.2);
            box-shadow: 0 0 8px rgba(0, 123, 255, 0.5);
        }
        
        .logo-item:hover {
            border: 2px dashed #007bff;
        }
        .logo-item img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        .logo-controls {
            position: absolute;
            top: -20px;
            right: -20px;
            display: none;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            padding: 3px;
            z-index: 101;
        }
        .logo-item:hover .logo-controls {
            display: block;
        }
        .btn-logo-control {
            font-size: 12px;
            padding: 2px 5px;
            margin: 0 2px;
        }
        .logo-preview {
            width: 60px;
            height: 60px;
            object-fit: contain;
            border: 1px solid #ddd;
            cursor: pointer;
        }
        .logo-preview.active {
            border: 2px solid #007bff;
        }
        .product-type-row {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        .product-type-label {
            margin-bottom: 10px;
            font-weight: 500;
        }
        #select-product-type {
            width: 100%;
            text-align: left;
            padding: 8px 12px;
            font-size: 14px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        /* Estilos para el modal de selección de productos */
        .product-card {
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            border-color: #e9ecef;
        }
        .product-card.selected {
            border-color: #0d6efd;
            background-color: rgba(13, 110, 253, 0.05);
        }
        .product-card img {
            max-height: 150px;
            object-fit: contain;
        }
        .current-product-display {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            width: 100%;
        }
    </style>
</head>
<body>
z
    <main class="main">
    <div class="main-container">
        <h1 class="page-title">Diseñador Virtual</h1>
        
        <!-- Barra de botones de acción -->
        <div class="d-flex justify-content-center mb-4">
            <button id="btn-cotizar" class="btn btn-success">
                <i class="bi bi-calculator"></i> Cotizar
            </button>
        </div>
        
        <!-- Formulario oculto para enviar datos a la página de cotizador -->
        <form id="cotizacion-form" action="{{ url_for('cotizador') }}" method="post" style="display: none;">
            <!-- Datos básicos del producto -->
            <input type="hidden" name="producto" id="form-producto" value="Polo Manga Corta">
            <input type="hidden" name="color" id="form-color" value="Blanco">
            <input type="hidden" name="color_hex" id="form-color-hex" value="#FFFFFF">
            <input type="hidden" name="color_opacity" id="form-color-opacity" value="0.8">
            <input type="hidden" name="impresion" id="form-impresion" value="Estampado">
            
            <!-- Datos del texto -->
            <input type="hidden" name="texto" id="form-texto" value="">
            <input type="hidden" name="texto_size" id="form-texto-size" value="24">
            <input type="hidden" name="texto_color" id="form-texto-color" value="#000000">
            <input type="hidden" name="texto_bold" id="form-texto-bold" value="normal">
            <input type="hidden" name="texto_italic" id="form-texto-italic" value="normal">
            <input type="hidden" name="texto_underline" id="form-texto-underline" value="none">
            <input type="hidden" name="texto_frente" id="form-texto-frente" value="true">
            <input type="hidden" name="texto_espalda" id="form-texto-espalda" value="false">
            <input type="hidden" name="texto_izquierda" id="form-texto-izquierda" value="false">
            <input type="hidden" name="texto_derecha" id="form-texto-derecha" value="false">
            
            <!-- Datos de logos -->
            <input type="hidden" name="logos_html" id="form-logos-html" value="">
            <input type="hidden" name="logos_html_espalda" id="form-logos-html-espalda" value="">
            <input type="hidden" name="logos_html_izquierda" id="form-logos-html-izquierda" value="">
            <input type="hidden" name="logos_html_derecha" id="form-logos-html-derecha" value="">
            
            <!-- Rutas de imágenes -->
            <input type="hidden" name="vista_frente" id="form-vista-frente" value="/static/img/creador/Polo manga corta/Blanco/camiseta_Blanco_manga-corta_front.webp">
            <input type="hidden" name="vista_espalda" id="form-vista-espalda" value="/static/img/creador/Polo manga corta/Blanco/camiseta_Blanco_manga-corta_back.webp">
            <input type="hidden" name="vista_izquierda" id="form-vista-izquierda" value="/static/img/creador/Polo manga corta/Blanco/camiseta_Blanco_manga-corta_left.webp">
            <input type="hidden" name="vista_derecha" id="form-vista-derecha" value="/static/img/creador/Polo manga corta/Blanco/camiseta_Blanco_manga-corta_right.webp">
        </form>
        
        <div class="row g-4 justify-content-center">
            <div class="col-md-12 d-flex justify-content-center" style="max-width: 1400px;">
                <!-- Left Column - Controls -->
                <div class="col-md-3 pe-2">
                    <!-- Tipo Producto -->
                    <div class="section-card">
                        <h5 class="section-header bg-warning text-black">Tipo Producto</h5>
                        <div class="section-body">
                            <div class="d-flex flex-column align-items-center">
                                <div class="current-product-display mb-3 text-center">
                                    <p class="mb-1">Producto actual:</p>
                                    <h5 id="current-product-name" class="fw-bold">Polo Manga Corta</h5>
                                </div>
                                <button type="button" class="btn btn-warning w-100" data-bs-toggle="modal" data-bs-target="#productSelectionModal">
                                    <i class="bi bi-grid-3x3-gap-fill me-2"></i>Seleccionar Producto
                                </button>
                                <!-- Campo oculto para almacenar el valor del producto seleccionado -->
                                <input type="hidden" id="selectedProductType" value="Polo manga corta">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Vista -->
                    <div class="section-card">
                        <h5 class="section-header bg-warning text-black">Vista</h5>
                        <div class="section-body text-center">
                            <div id="view-frente" class="view-option active">Frente</div>
                            <div id="view-espalda" class="view-option">Espalda</div>
                            <div id="view-izquierda" class="view-option">Izquierda</div>
                            <div id="view-derecha" class="view-option">Derecha</div>
                        </div>
                    </div>
                    
                    <!-- Colores Disponibles -->
                    <div class="section-card">
                        <h5 class="section-header bg-warning text-black">Colores Disponibles</h5>
                        <div class="section-body">
                            <div id="color-availability-message" class="small text-muted mb-2"></div>
                            <div class="d-flex justify-content-start flex-wrap" id="color-options">
                                <!-- White -->
                                <div class="color-option" data-color="Blanco" data-available-in="both" style="background-color: #ffffff;"></div>
                                <!-- Black -->
                                <div class="color-option" data-color="Negro" data-available-in="both" style="background-color: #000000;"></div>
                                <!-- Light Blue -->
                                <div class="color-option" data-color="Azul_cielo" data-available-in="both" style="background-color: #87CEEB;"></div>
                                <!-- Blue -->
                                <div class="color-option" data-color="Azul_electrico" data-available-in="both" style="background-color: #0000FF;"></div>
                                <!-- Navy Blue -->
                                <div class="color-option" data-color="Azul_marino" data-available-in="both" style="background-color: #000080;"></div>
                                <!-- Beige -->
                                <div class="color-option" data-color="Beige" data-available-in="both" style="background-color: #F5F5DC;"></div>
                                <!-- Light Gray -->
                                <div class="color-option" data-color="Gris_claro" data-available-in="both" style="background-color: #D3D3D3;"></div>
                                <!-- Medium Gray -->
                                <div class="color-option" data-color="Gris_intermedio" data-available-in="both" style="background-color: #808080;"></div>
                                <!-- Dark Gray -->
                                <div class="color-option" data-color="Gris_oscuro" data-available-in="both" style="background-color: #404040;"></div>
                                <!-- Coral -->
                                <div class="color-option" data-color="Naranja_Coral" data-available-in="both" style="background-color: #FF7F50;"></div>
                                <!-- Salmon -->
                                <div class="color-option" data-color="Naranja_salmon" data-available-in="both" style="background-color: #FA8072;"></div>
                                <!-- Wine Red -->
                                <div class="color-option" data-color="Rojo_vino" data-available-in="both" style="background-color: #722F37;"></div>
                                <!-- Yellow -->
                                <div class="color-option" data-color="Amarillo_mostaza" data-available-in="corta" style="background-color: #FFDB58;"></div>
                                <!-- Red -->
                                <div class="color-option" data-color="Rojo" data-available-in="corta" style="background-color: #FF0000;"></div>
                                <!-- Pink -->
                                <div class="color-option" data-color="Rosa_pastel" data-available-in="corta" style="background-color: #FFD1DC;"></div>
                                <!-- Olive Green -->
                                <div class="color-option" data-color="Verde_oliva" data-available-in="corta" style="background-color: #556B2F;"></div>
                                <!-- Bottle Green -->
                                <div class="color-option" data-color="Verde_botella" data-available-in="corta" style="background-color: #006400;"></div>
                            </div>
                            
                            <div class="mt-3">
                                <button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#colorPickerModal">
                                    <i class="bi bi-plus-circle"></i> Agregar Color Personalizado
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Tipo Impresión -->
                    <div class="section-card">
                        <h5 class="section-header bg-warning text-black">Tipo Impresión</h5>
                        <div class="section-body">
                            <div class="mb-3">
                                <div class="d-flex align-items-center mb-2">
                                    <span class="me-2" style="font-size: 0.9rem;">Tipo:</span>
                                    <div class="dropdown">
                                        <button class="btn btn-outline-secondary dropdown-toggle" type="button" id="select-print-type" data-bs-toggle="dropdown" aria-expanded="false">
                                            Estampado
                                        </button>
                                        <ul class="dropdown-menu" aria-labelledby="select-print-type">
                                            <li><a class="dropdown-item print-type-option" href="#" data-print-type="Estampado">Estampado</a></li>
                                            <li><a class="dropdown-item print-type-option" href="#" data-print-type="Bordado">Bordado</a></li>
                                            <li><a class="dropdown-item print-type-option" href="#" data-print-type="Sublimado">Sublimado</a></li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="alert alert-primary py-2 mt-2" id="print-type-display">
                                    <i class="bi bi-info-circle-fill me-2"></i>
                                    <strong>Tipo de impresión seleccionado:</strong> <span id="current-print-type" class="fw-bold">Estampado</span>
                                </div>
                                <div id="print-type-description" class="small text-muted mt-2">
                                    El estampado es ideal para diseños con muchos colores y detalles.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Middle Column - Shirt Preview -->
                <div class="col-md-6 px-2">
                    <div class="section-card h-100">
                        <h5 class="section-header bg-warning text-black">Vista Previa</h5>
                        <div class="section-body p-3">
                            <div class="shirt-preview-container" id="shirt-container">
                                <!-- Capa base (imagen original) -->
                                <img id="shirt-image-base" src="/static/img/creador/Polo manga corta/Blanco/camiseta_Blanco_manga-corta_front.webp" class="shirt-preview" alt="Polo">
                                
                                <!-- Capa de color (se aplicará el color personalizado) -->
                                <div id="shirt-color-overlay" class="shirt-color-overlay"></div>
                                
                                <!-- Capa superior (imagen con huecos) -->
                                <img id="shirt-image-overlay" src="" class="shirt-preview" alt="Overlay" style="display: none;">
                                
                                <!-- Contenedor para logos y textos -->
                                <div class="logo-container" id="logo-container"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Right Column - Text and Logo Controls -->
                <div class="col-md-3 ps-2">
                    <!-- Agregar Texto -->
                    <div class="section-card">
                        <h5 class="section-header bg-warning text-black">Agregar Texto</h5>
                        <div class="section-body">
                            <div class="mb-3">
                                <label for="text-input" class="form-label">Texto a agregar</label>
                                <input type="text" class="form-control" id="text-input" placeholder="Escribe tu texto aquí">
                            </div>
                            
                            <div class="row mb-3">
                                <div class="col-6">
                                    <label for="font-family" class="form-label">Tipo de letra</label>
                                    <select class="form-select" id="font-family">
                                        <option value="Arial">Arial</option>
                                        <option value="Roboto">Roboto</option>
                                        <option value="Open Sans">Open Sans</option>
                                        <option value="Lato">Lato</option>
                                        <option value="Montserrat">Montserrat</option>
                                        <option value="Oswald">Oswald</option>
                                    </select>
                                </div>
                                <div class="col-6">
                                    <label for="font-size" class="form-label">Tamaño</label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="font-size" value="24" min="8" max="72">
                                        <span class="input-group-text">px</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="font-color" class="form-label">Color del texto</label>
                                <input type="color" class="form-control form-control-color w-100" id="font-color" value="#000000">
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Estilo</label>
                                <div class="d-flex">
                                    <div class="form-check me-3">
                                        <input class="form-check-input" type="checkbox" id="font-bold">
                                        <label class="form-check-label" for="font-bold">Negrita</label>
                                    </div>
                                    <div class="form-check me-3">
                                        <input class="form-check-input" type="checkbox" id="font-italic">
                                        <label class="form-check-label" for="font-italic">Cursiva</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="font-underline">
                                        <label class="form-check-label" for="font-underline">Subrayado</label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Vista previa del texto</label>
                                <div id="text-preview" class="p-2 border rounded text-center">
                                    Vista previa del texto
                                </div>
                            </div>
                            
                            <div class="d-grid gap-2">
                                <button class="btn btn-warning" id="add-text-btn">Agregar texto al polo</button>
                                <button class="btn btn-outline-secondary" id="clear-text-btn" type="button">Limpiar campos</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Agregar Logos e Imágenes -->
                    <div class="section-card">
                        <h5 class="section-header bg-warning text-black">Agregar Logos e Imágenes</h5>
                        <div class="section-body">
                            <div class="mb-3">
                                <label for="logo-upload" class="form-label">Subir imágenes o logos (solo PNG)</label>
                                <input class="form-control" type="file" id="logo-upload" accept=".png, image/png" multiple>
                                <div class="form-text">Solo se aceptan archivos en formato PNG.</div>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Logos subidos</label>
                                <div id="logo-gallery" class="d-flex flex-wrap">
                                    <!-- Uploaded logos will appear here -->
                                </div>
                            </div>
                            
                            <div class="mt-2">
                                <p class="small text-muted mb-0">* Arrastra las imágenes para posicionarlas en el polo.</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Modal para confirmar cambio de tipo de producto -->
                <div class="modal fade" id="confirmChangeModal" tabindex="-1" aria-labelledby="confirmChangeModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="confirmChangeModalLabel">Confirmar cambio</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <p>Has realizado modificaciones en el producto actual. Si cambias de producto, se perderán todos los cambios (colores personalizados, imágenes, textos y configuración de impresión).</p>
                                <p>¿Estás seguro de que quieres cambiar el tipo de producto?</p>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                                <button type="button" class="btn btn-primary" id="confirmChangeBtn">Sí, cambiar</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Modal para seleccionar color personalizado -->
                <div class="modal fade" id="colorPickerModal" tabindex="-1" aria-labelledby="colorPickerModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header bg-primary text-white">
                                <h5 class="modal-title" id="colorPickerModalLabel">Elegir un color nuevo</h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <div class="mb-3">
                                    <label for="custom-color-picker" class="form-label">Selecciona un color:</label>
                                    <input type="color" class="form-control form-control-color w-100" id="custom-color-picker" value="#3f48cc">
                                </div>
                                <div class="mb-3">
                                    <label for="custom-color-name" class="form-label">Nombre del color (opcional):</label>
                                    <input type="text" class="form-control" id="custom-color-name" placeholder="Ej: Azul personalizado">
                                </div>
                                <div class="mb-3">
                                    <label for="custom-color-opacity" class="form-label">Intensidad del color: <span id="opacity-value">80%</span></label>
                                    <input type="range" class="form-range" id="custom-color-opacity" min="0" max="100" value="80">
                                </div>
                                <div class="d-flex align-items-center mt-4">
                                    <div class="me-3">
                                        <strong>Vista previa:</strong>
                                    </div>
                                    <div id="color-preview" style="width: 80px; height: 80px; border-radius: 50%; border: 2px solid #ddd; background-color: #3f48cc;"></div>
                                </div>
                                <div class="alert alert-info mt-3">
                                    <small><i class="bi bi-info-circle"></i> Los colores personalizados utilizan la tecnología de superposición de capas para aplicar el color seleccionado a la prenda.</small>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                                <button type="button" class="btn btn-primary" id="add-custom-color-btn">Agregar color</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </main>


    <!-- Cart Sidebar -->
    <div class="cart">
        <div class="cart__head">
            <h2 class="cart__title">Tu carrito</h2>
            <button id="btnCerrarCarrito" class="cart__button-close">X</button>
        </div>
        <hr>
        <div style="display: none;" data-tallas="S,X,M" data-cant-tallas="4,2,6"></div>
        <div class="cart__body">
            <!-- Cart items will be dynamically inserted here -->
        </div>
        <hr>
        <div class="cart__foot">
            <div class="cart__subtotal">
                <span class="cart__subtotal-label">Subtotal:</span>
                <span class="cart__subtotal-price">0.00</span>
            </div>
            <div class="cart__actions">
                <button id="btnVaciarCarrito" class="button button--secondary button--cart-foot">Vaciar carrito</button>
                <a href="{{ url_for('pago') }}" class="button button--primary button--cart-foot">Pagar todo</a>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer__column">
            <h3 class="footer__title">Sobre nosotros</h3>
            <p class="footer__text">Somos una empresa dedicada a ofrecer productos de calidad.</p>
            <a href="#" class="footer__link">Leer más</a>
        </div>

        <div class="footer__column">
            <h3 class="footer__title">Enlaces rápidos</h3>
            <ul class="footer__list">
                <li><a href="{{ url_for('inicio') }}" class="footer__link">Inicio</a></li>
                <li><a href="{{ url_for('catalogo') }}" class="footer__link">Catálogo</a></li>
                <li><a href="{{ url_for('prueba_nuevo') }}" class="footer__link">Creador</a></li>
                <li><a href="{{ url_for('contactanos') }}" class="footer__link">Contáctanos</a></li>
            </ul>
        </div>

        <div class="footer__column">
            <h3 class="footer__title">Contáctanos</h3>
            <p class="footer__text">Dirección: Calle Ficticia, 123</p>
            <p class="footer__text">Email: jbctextil@gmail.com</p>
            <p class="footer__text">Tel: 971813121</p>
        </div>
    </footer>

    <!-- Modal para selección de productos -->
    <div class="modal fade" id="productSelectionModal" tabindex="-1" aria-labelledby="productSelectionModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="productSelectionModalLabel">Seleccionar Producto</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row row-cols-1 row-cols-md-3 g-4" id="product-grid">
                        <!-- Polo Manga Corta -->
                        <div class="col">
                            <div class="card h-100 product-card" data-product-type="Polo manga corta">
                                <img src="/static/img/creador/Polo manga corta/Blanco/camiseta_Blanco_manga-corta_front.webp" class="card-img-top p-3" alt="Polo Manga Corta">
                                <div class="card-body text-center">
                                    <h5 class="card-title">Polo Manga Corta</h5>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Polo Manga Larga -->
                        <div class="col">
                            <div class="card h-100 product-card" data-product-type="Polo manga larga">
                                <img src="/static/img/creador/Polo manga larga/Blanco/camiseta_Blanco_manga-larga_front.webp" class="card-img-top p-3" alt="Polo Manga Larga">
                                <div class="card-body text-center">
                                    <h5 class="card-title">Polo Manga Larga</h5>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Casaca -->
                        <div class="col">
                            <div class="card h-100 product-card" data-product-type="casaca">
                                <img src="/static/img/creador/casaca/casaca_parka_blanca_lisa_front.webp" class="card-img-top p-3" alt="Casaca">
                                <div class="card-body text-center">
                                    <h5 class="card-title">Casaca</h5>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Chompa -->
                        <div class="col">
                            <div class="card h-100 product-card" data-product-type="chompa">
                                <img src="/static/img/creador/chompa/chompa_blanca_front.webp" class="card-img-top p-3" alt="Chompa">
                                <div class="card-body text-center">
                                    <h5 class="card-title">Chompa</h5>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Mameluco -->
                        <div class="col">
                            <div class="card h-100 product-card" data-product-type="mameluco">
                                <img src="/static/img/creador/mameluco/mameluco_blanco_front.webp" class="card-img-top p-3" alt="Mameluco">
                                <div class="card-body text-center">
                                    <h5 class="card-title">Mameluco</h5>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Pantalón -->
                        <div class="col">
                            <div class="card h-100 product-card" data-product-type="pantalon">
                                <img src="/static/img/creador/pantalon/pantalon_jean_blanco_front.webp" class="card-img-top p-3" alt="Pantalón">
                                <div class="card-body text-center">
                                    <h5 class="card-title">Pantalón</h5>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS and dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Include interact.js for drag, resize, and rotate functionality -->
    <script src="https://cdn.jsdelivr.net/npm/interactjs@1.10.11/dist/interact.min.js"></script>
    <!-- Include Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Open+Sans:wght@400;700&family=Lato:wght@400;700&family=Montserrat:wght@400;700&family=Oswald:wght@400;700&display=swap" rel="stylesheet">
    <!-- Include Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    
    <!-- Incluir el nuevo archivo JavaScript -->
    <script src="/static/js/probador_color.js"></script>
    
    <!-- Script para manejar el botón de cotizar -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Obtener referencias a elementos
            const btnCotizar = document.getElementById('btn-cotizar');
            const cotizacionForm = document.getElementById('cotizacion-form');
            
            // Manejar clic en botón cotizar
            btnCotizar.addEventListener('click', function() {
                // Actualizar datos del producto
                document.getElementById('form-producto').value = document.getElementById('current-product-name').textContent;
                document.getElementById('form-impresion').value = document.getElementById('current-print-type').textContent;
                
                // Obtener datos del color actual
                const colorActivo = document.querySelector('.color-option.active');
                if (colorActivo) {
                    // Obtener el nombre del color y el valor hexadecimal
                    const colorName = colorActivo.getAttribute('data-color-name') || 'Blanco';
                    let colorHex = colorActivo.style.backgroundColor || '#FFFFFF';
                    
                    // Si el color es un valor RGB, convertirlo a hexadecimal
                    if (colorHex.startsWith('rgb')) {
                        colorHex = rgbToHex(colorHex);
                    } else if (!colorHex.startsWith('#')) {
                        // Si no es un color hexadecimal ni RGB, usar el fondo del elemento
                        colorHex = window.getComputedStyle(colorActivo).backgroundColor;
                        colorHex = rgbToHex(colorHex);
                    }
                    
                    // Obtener la opacidad del color
                    const colorOpacity = '0.8';
                    
                    // Actualizar los valores en el formulario
                    document.getElementById('form-color').value = colorName;
                    document.getElementById('form-color-hex').value = colorHex;
                    document.getElementById('form-color-opacity').value = colorOpacity;
                    
                    console.log('Color seleccionado:', colorName, colorHex, colorOpacity);
                }
                
                // Obtener datos del texto
                const textItems = document.querySelectorAll('.text-item');
                if (textItems.length > 0) {
                    // Tomamos el primer texto como referencia (podría mejorarse para múltiples textos)
                    const textItem = textItems[0];
                    const texto = textItem.textContent;
                    document.getElementById('form-texto').value = texto;
                    
                    // Obtener estilos del texto
                    const style = window.getComputedStyle(textItem);
                    document.getElementById('form-texto-size').value = parseInt(style.fontSize) || 24;
                    document.getElementById('form-texto-color').value = rgbToHex(style.color) || '#000000';
                    document.getElementById('form-texto-bold').value = style.fontWeight === 'bold' ? 'bold' : 'normal';
                    document.getElementById('form-texto-italic').value = style.fontStyle === 'italic' ? 'italic' : 'normal';
                    document.getElementById('form-texto-underline').value = style.textDecoration.includes('underline') ? 'underline' : 'none';
                    
                    // Determinar en qué vista está el texto (por defecto en frente)
                    document.getElementById('form-texto-frente').value = 'true';
                }
                
                // Capturar HTML de logos e imágenes
                const logoContainer = document.getElementById('logo-container');
                if (logoContainer && logoContainer.innerHTML.trim() !== '') {
                    document.getElementById('form-logos-html').value = logoContainer.innerHTML;
                }
                
                // Obtener rutas de imágenes actuales
                const productoSeleccionado = document.getElementById('selectedProductType').value;
                const colorSeleccionado = document.getElementById('form-color').value;
                const baseUrl = `/static/img/creador/${productoSeleccionado}/${colorSeleccionado}/`;
                
                // Actualizar rutas de imágenes en el formulario
                document.getElementById('form-vista-frente').value = baseUrl + `camiseta_${colorSeleccionado}_manga-corta_front.webp`;
                document.getElementById('form-vista-espalda').value = baseUrl + `camiseta_${colorSeleccionado}_manga-corta_back.webp`;
                document.getElementById('form-vista-izquierda').value = baseUrl + `camiseta_${colorSeleccionado}_manga-corta_left.webp`;
                document.getElementById('form-vista-derecha').value = baseUrl + `camiseta_${colorSeleccionado}_manga-corta_right.webp`;
                
                // Enviar formulario
                cotizacionForm.submit();
            });
            
            // Función auxiliar para convertir RGB a Hex
            function rgbToHex(rgb) {
                if (!rgb || rgb === 'transparent') return '#FFFFFF';
                
                // Si ya es un color hex, devolverlo
                if (rgb.startsWith('#')) return rgb;
                
                // Extraer valores RGB
                const rgbMatch = rgb.match(/^rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/);
                if (!rgbMatch) return '#FFFFFF';
                
                const r = parseInt(rgbMatch[1]);
                const g = parseInt(rgbMatch[2]);
                const b = parseInt(rgbMatch[3]);
                
                return '#' + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1).toUpperCase();
            }
        });
    </script>
</body>
</html>
